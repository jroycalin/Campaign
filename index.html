<!doctype html>
<html lang="en">
<head>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scratch & Win</title>

<style>
body {
  background: linear-gradient(135deg, #ffffff, #ffecec);
  font-family: 'Roboto', Arial, sans-serif;
  margin: 0;
  padding: 10px;
  color: #333;
}

/* Responsive container */
.container {
  max-width: 600px;
  margin: 0 auto;
  padding: 16px;
  box-sizing: border-box;
}

/* Logo */
.logo {
  text-align:center; 
  margin:20px 0;
}
.logo img {
  max-width: 160px;
  height: auto;
}

/* Banner */
.banner {
  background: url('https://mobixpress.in/assets/images/banner.jpg') no-repeat center center/cover;
  width: 100%;
  height: 25vh;
  min-height: 180px;
  border-radius: 12px;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  animation: fadeIn 1.5s ease-in-out;
}

.banner-overlay {
  background: rgba(255, 0, 0, 0.35);
  width: 100%;
  height: 100%;
  border-radius: 12px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  color: #fff;
}

.banner-overlay h3 {
  font-size: clamp(18px, 4vw, 28px);
  font-weight: 700;
  animation: slideDown 1s ease-in-out;
  margin: 0;
}

.banner-overlay p {
  font-size: clamp(14px, 3vw, 20px);
  animation: fadeInUp 1.2s ease-in-out;
  margin: 8px 0 0;
}

/* Form */
form {
  margin: 20px 0;
}
input {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 16px;
  box-sizing: border-box;
}
button {
  background: #E1302F;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 14px;
  width: 100%;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
}
button:hover {
  background: #c1272d;
}
button:disabled {
  background: #ccc;
}

/* Scratch Card */
#scratchCanvas {
  width: 100%;
  max-width: 350px;
  height: auto;
  aspect-ratio: 7/3; /* keep shape */
  border: 2px solid #ccc;
  border-radius: 8px;
  margin: 20px auto;
  
  cursor: pointer;
}
#scratchCanvas.hidden { display: none !important; }

/* Result */
.result {
  font-size: clamp(18px, 5vw, 24px);
  font-weight: bold;
  margin-top: 15px;
  text-align: center;
}
.result strong {
  color: #E1302F;
  font-size: clamp(20px, 6vw, 28px);
  display: inline-block;
  margin-top: 10px;
}

/* Animations */
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
@keyframes slideDown { from {transform: translateY(-40px); opacity:0;} to {transform: translateY(0); opacity:1;} }
@keyframes fadeInUp { from {transform: translateY(40px); opacity:0;} to {transform: translateY(0); opacity:1;} }

.hidden { display: none; }
</style>
</head>

<body>
<div class="container">
  <!-- Logo -->
  <div class="logo">
    <img src="logo.png" alt="Mobixpress">
  </div>

  <!-- Banner -->
  <div class="banner">
    <div class="banner-overlay">
      <h3>ðŸŽ‰ Scratch & Win with Mobixpress ðŸŽ‰</h3>
      <p id="message">Exciting prizes are waiting for you!</p>
    </div>
  </div>

  <!-- Form -->
  <form id="userForm">
    <input type="text" id="name" placeholder="Your Name" required />
    <input type="email" id="email" placeholder="Your Email" required />
    <button type="submit">Start Playing</button>
  </form>

  <!-- Scratch Canvas -->
  <canvas id="scratchCanvas" class="hidden"></canvas>
  <div id="result" class="result hidden"></div>
</div>

<script>
const PRIZES = [
  { name: "Mobile", weight: 50 },
  { name: "Laptop", weight: 40 },
  { name: "Tab", weight: 30 },
  { name: "Car", weight: 20 }
];
const CLAIM_URL = "https://script.google.com/macros/s/AKfycbxdOKPGTgQGq4Bxts4jkU7Vd3_f1LII-rsRFNo7pw1Ub3mK8tTKBHts1JtaSAlYvPXcxg/exec"; // replace with your deployed Apps Script URL

let user = {};
const canvas = document.getElementById("scratchCanvas");
const ctx = canvas.getContext("2d");
const resultEl = document.getElementById("result");
let prize = null;
let prizeClaimed = false;

document.getElementById("userForm").addEventListener("submit", e => {
  e.preventDefault();
  user.name = document.getElementById("name").value;
  user.email = document.getElementById("email").value;
  document.getElementById("userForm").classList.add("hidden");
  canvas.classList.remove("hidden");
  initScratch();
});

function pickPrize() {
  const total = PRIZES.reduce((a,b) => a + b.weight, 0);
  let r = Math.random() * total;
  for (let p of PRIZES) {
    if (r < p.weight) return p;
    r -= p.weight;
  }
  return PRIZES[PRIZES.length-1];
}

function initScratch() {
prize = pickPrize();
  ctx.fillStyle = "#999";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.globalCompositeOperation = "destination-out";
  canvas.addEventListener("mousemove", scratch);
  canvas.addEventListener("touchmove", scratch);

  canvas.addEventListener("touchstart", e => {
  e.preventDefault(); // stop screen from scrolling
  isDrawing = true;
  lastX = e.touches[0].clientX - canvas.getBoundingClientRect().left;
  lastY = e.touches[0].clientY - canvas.getBoundingClientRect().top;
}, { passive: false });

canvas.addEventListener("touchmove", e => {
  e.preventDefault(); // stop scrolling
  if (!isDrawing) return;
  const x = e.touches[0].clientX - canvas.getBoundingClientRect().left;
  const y = e.touches[0].clientY - canvas.getBoundingClientRect().top;
  scratchAt(x, y);
}, { passive: false });

canvas.addEventListener("touchend", () => {
  isDrawing = false;
}, { passive: false });
}

function scratch(e) {
  const rect = canvas.getBoundingClientRect();
  const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
  const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
  ctx.beginPath();
  ctx.arc(x,y,15,0,Math.PI*2);
  ctx.fill();
  checkReveal();
}

function checkReveal() {
  const pixels = ctx.getImageData(0,0,canvas.width,canvas.height).data;
  let cleared = 0;
  for (let i=3;i<pixels.length;i+=4) if (pixels[i] === 0) cleared++;
  if (cleared / (pixels.length/4) > 0.5) showPrize();
}

function showPrize() {
  if (prizeClaimed) return;
  prizeClaimed = true;

  // stop further scratching
  canvas.removeEventListener("mousemove", scratch);
  canvas.removeEventListener("touchmove", scratch);
  ctx.globalCompositeOperation = "source-over";

  // hide the canvas decisively
  canvas.classList.add("hidden");
  canvas.style.display = "none";

  document.getElementById("message").classList.add("hidden");
  resultEl.innerHTML = `ðŸŽ‰ You have won ðŸŽ‰<br/><strong>${prize.name}</strong>`;
  resultEl.classList.remove("hidden");

  claimPrize();

  confetti({ particleCount: 180, spread: 80, origin: { y: 0.6 } });
}

async function claimPrize() {
  const payload = { 
    name: user.name, 
    email: user.email, 
    prize: prize.name, 
    code: Math.random().toString(36).substring(2,8), 
    utm: window.location.search 
  };
  try {
    await fetch(CLAIM_URL, { method:"POST", body: JSON.stringify(payload) });
  } catch(err) { console.error(err); }
}
</script>
</body>
</html>




